# Проект по инфопоиску и базам данных

Эта работа представляет собой простую поисковую систему, которая позволяет выполнять поиск по текстам с использованием двух методов индексации: TF-IDF и эмбеддингов BERT. Система поддерживает предварительное вычисление индексов и сохранение их в файлы, чтобы избежать повторных расчетов.

## Инфопоиск

### 1. Корпус данных

В проекте используется вопросов к психологу и ответов от психологов с сайта psiholog.ru 

### 2. Предобработка текста

Тексты проходят следующие этапы обработки перед индексацией (для tf-idf):
- Приведение к нижнему регистру
- Удаление пунктуации
- Лемматизация слов с использованием библиотеки `pymorphy2`
- Удаление стоп-слов с использованием библиотеки `nltk`

### 3. Индексация

Реализованы два способа индексации:
- **TF-IDF** : Преобразует тексты в числовые векторы на основе частоты слов в документах и их редкости в корпусе. Для индексации используется `TfidfVectorizer` из библиотеки `scikit-learn`.
- **BERT** : Токенизация через BertTokenizer. Модель `ruBERT` от `DeepPavlov` используется для генерации эмбеддингов предложений. Она обучена на русскоязычных текстах и токенизирует текст перед преобразованием в эмбеддинги.

### 4. Поиск

Система поддерживает поиск по запросу с использованием выбранного метода индексации (TF-IDF или BERT). Есть возможность выбрать, сколько документов получить на выходе.
Поиск основан на косинусном сходстве между запросом и векторами документов.


## Подготовка данных

Перед запуском поиска необходимо выполнить индексацию текстов.

### 1. Загрузка и предобработка корпуса
### 2. Индексация TF-IDF
### 3. Индексация BERT
## Запуск поиска
### Пример использования:

```markdown
Введите текст запроса: Пример запроса
Введите, какой вариант индекса использовать ('tf-idf' или 'bert'): tf-idf
Введите количество текстов в выдаче: 3
```

Программа вернет список из x наиболее релевантных документов с указанием степени их сходства с запросом.

## Flask API с использованием Pydantic и Enum

### Описание эндпоинтов

1. **GET `/methods`**  
Возвращает список доступных методов анализа данных.  
**Формат ответа:**  
`{"methods": ["tf-idf", "bert"]}`  

2. **GET `/corpora`**  
Возвращает информацию о корпусе, включая количество примеров и название.  
**Формат ответа:**  
`{"examples": 9933, "name": "psycho"}`  

3. **POST `/search`**  
Выполняет поиск по указанным параметрам.  

**Формат входных данных:**  
`{"query": "example query", "index_choice": "tf-idf", "df_cleaned": [{"text": "example1"}, {"text": "example2"}]}`  

**Формат ответа:**  
`{"result": [{"query": "example query", "engine": "TF-IDF", "matches": 2}]}`  

**Пример вызова:**  
`curl -X POST http://127.0.0.1:5000/search -H "Content-Type: application/json" -d '{"query": "example query", "index_choice": "tf-idf", "df_cleaned": [{"text": "example1"}, {"text": "example2"}]}'`


## Базы данных

## Схема базы данных

![Схема базы данных](bd_scheme.png)

## Осуществление подключения к БД через Python 

```
import mysql.connector

connection = mysql.connector.connect(
    host="localhost",
    user="root",
    password="T8xXSnKJ",
    database="psychologist_db"
)

cursor = connection.cursor()
cursor.execute("SELECT * FROM Questions;")
existing_data = cursor.fetchall()

for row in existing_data:
    print(row)

connection.close()
```
Можно осуществлять добавление, удаление, обновление данных в БД

## Созданы запросы к БД

Пример запроса: 
```
easy = """
            SELECT q.question_title, q.question_body, a.answers
            FROM Questions q
            JOIN questions_answers q_a on q.id = q_a.question_id
            JOIN Answers a ON q_a.answer_id = a.id
            WHERE qbody_keyword_1 = 'депрессия’
   or qbody_keyword_2 = 'смерть' 
   or qbody_keyword_3 = 'работа';
            """
```
## Сhroma

Создана коллекция, есть возможность выполнять запросы. Пример запроса: 
```
query_text = "Как научиться снова доверять жене?" 
results = collection.query(
    query_texts=[query_text],
    n_results=5 
)

print("Результаты поиска:", results)
```

## Структура файлов

```
.
├── README.md                  # Этот файл
├── Проект_Захарова Яна.ipynb  # Основной скрипт с логикой проекта
├── tfidf_vectorizer1.pkl      # Предобученный TF-IDF векторизатор
├── tfidf_matrix1.pkl          # Матрица TF-IDF
├── bert_embeddings1.pkl       # Эмбеддинги BERT
├── df_cleaned.csv             # База данных
├── api.py                     # API
├── search_engine.py           # Скрипт в инфопоиском
├── README_API.md              # Описание API
├── bd_scheme.png              # Схема базы данных
```
